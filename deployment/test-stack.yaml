{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "The template used to create an ECS Cluster from the ECS Console.",
  "Parameters": {
    "ECSClusterName": {
      "Type": "String",
      "Description": "Specifies the ECS Cluster Name with which the resources would be associated",
      "Default": "YF86-bot-cluster"
    },
    "VpcId": {
      "Type": "String",
      "Description": "Optional - Specifies the ID of an existing VPC in which to launch your container instances. If you specify a VPC ID, you must specify a list of existing subnets in that VPC. If you do not specify a VPC ID, a new VPC is created with atleast 1 subnet.",
      "Default": "",
      "AllowedPattern": "^(?:vpc-[0-9a-f]{8,17}|)$",
      "ConstraintDescription": "VPC Id must begin with 'vpc-' and have a valid uuid"
    },
    "SubnetIds": {
      "Type": "CommaDelimitedList",
      "Description": "Optional - Specifies the Comma separated list of existing VPC Subnet Ids where ECS instances will run",
      "Default": ""
    }
  },
  "Resources": {
    "ECSCluster": {
      "Type": "AWS::ECS::Cluster",
      "Properties": {
        "ClusterName": {
          "Ref": "ECSClusterName"
        },
        "CapacityProviders": [
          "FARGATE",
          "FARGATE_SPOT"
        ],
        "ClusterSettings": [
          {
            "Name": "containerInsights",
            "Value": "disabled"
          }
        ],
        "Configuration": {
          "ExecuteCommandConfiguration": {
            "Logging": "DEFAULT"
          }
        },
        "ServiceConnectDefaults": {
          "Namespace": "YF86-bot"
        },
        "Tags": []
      }
    },
    "ECSTaskDefinition": {
      "Type": "AWS::ECS::TaskDefinition",
      "Properties": {
        "containerDefinitions": [
          {
            "name": "YF86-bot",
            "image": "docker.io/jfenuk/yf86-demo:main",
            "cpu": 0,
            "portMappings": [
              {
                "name": "YF86-bot-80-tcp",
                "containerPort": 80,
                "hostPort": 80,
                "protocol": "tcp",
                "appProtocol": "http"
              },
              {
                "name": "YF86-bot-443-tcp",
                "containerPort": 443,
                "hostPort": 443,
                "protocol": "tcp",
                "appProtocol": "http"
              }
            ],
            "essential": true,
            "environment": [],
            "environmentFiles": [],
            "mountPoints": [],
            "volumesFrom": [],
            "secrets": [
              {
                "name": "telegram.token",
                "valueFrom": "arn:aws:secretsmanager:eu-west-1:212516671447:secret:prod/yf86-demo/bot"
              }
            ],
            "logConfiguration": {
              "logDriver": "awslogs",
              "options": {
                "awslogs-create-group": "true",
                "awslogs-group": "/ecs/YF86-bot-task-definition",
                "awslogs-region": "eu-west-1",
                "awslogs-stream-prefix": "ecs"
              }
            }
          }
        ],
        "family": "YF86-bot-task-definition",
        "executionRoleArn": "arn:aws:iam::212516671447:role/ecs-task-execution-role-secret",
        "networkMode": "awsvpc",
        "revision": 6,
        "volumes": [],
        "status": "ACTIVE",
        "requiresAttributes": [
          {
            "name": "com.amazonaws.ecs.capability.logging-driver.awslogs"
          },
          {
            "name": "ecs.capability.execution-role-awslogs"
          },
          {
            "name": "com.amazonaws.ecs.capability.docker-remote-api.1.19"
          },
          {
            "name": "ecs.capability.secrets.asm.environment-variables"
          },
          {
            "name": "com.amazonaws.ecs.capability.docker-remote-api.1.18"
          },
          {
            "name": "ecs.capability.task-eni"
          },
          {
            "name": "com.amazonaws.ecs.capability.docker-remote-api.1.29"
          }
        ],
        "placementConstraints": [],
        "compatibilities": [
          "EC2",
          "FARGATE"
        ],
        "requiresCompatibilities": [
          "FARGATE"
        ],
        "cpu": "1024",
        "memory": "2048",
        "runtimePlatform": {
          "cpuArchitecture": "X86_64",
          "operatingSystemFamily": "LINUX"
        },
        "tags": []
      }
    }
  },
  "Outputs": {
    "ECSCluster": {
      "Description": "The created cluster.",
      "Value": {
        "Ref": "ECSCluster"
      }
    }
  }
}